env:
  DOCKER_COMPOSE_VERSION: 1.12.0

before_install:
  - sudo apt-get update
  - sudo apt-get -y -o Dpkg::Options::="--force-confnew" install docker-engine

branches:
  only:
    - master

sudo: required

services:
  - docker
  - mysql

script:
  - cp ./settings.travis-ci.py ./settings.py
  - export HOSTIP=`ip -4 addr show scope global dev eth0 | grep inet | awk '{print \$2}' | cut -d / -f 1`
  - docker pull mltshp/mltshp-web:latest
  - docker-compose --file docker-compose.travis-ci.yml run mltshp ./run-tests.sh

after_success:
  - docker container ls -a
  - docker exec -e COVERALLS_REPO_TOKEN mltshp_mltshp_1 coveralls
